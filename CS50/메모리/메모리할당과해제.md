# 메모리 할당과 해제

```c
malloc
free
...
```

> malloc 함수를 이용하여 메모리를 할당한 후에는 free라는 함수를 이용하여 메모리를 해제해주어야 한다.<br>그렇지 않은 경우 메모리에 저장한 값은 쓰레기 값으로 남게 되어 메모리 용량이 낭비되는 <b>메모리 누수</b>가 발생한다.

<b><i>free</i> 라는 함수는 할당되었던 메모리를 다시 반환한다.</b><br>
이 과정을 거쳐야 프로그램이 더 많은 메모리를 사용할 수 있게 된다.<br>
프로그램을 실행할 때마다 메모리를 할당만하고 해제하지 않으면 메모리는 점점 부족해지고 느려진다.<br>
따라서 사용하지 않는 메모리는 해제하는 것이 좋다.<br>

메모리 관련 실수를 확인하기 위해서는 <b>valgrind</b>라는 프로그램을 사용할 수 있다.

```
help50 valgrind ./filename
```

이러한 명령어를 사용하면 파일에 대한 valgrind의 검사 내용을 확인할 수 있다.

<br>

<br>

### 버퍼 오버플로우 예시

<i>(다음의 코드는 강의 자료로 valgrind 온라인 문서의 코드가 사용되었다.)</i>

```c
#include <stdlib.h>

void f(void)
{
    int *x = malloc(10 * sizeof(int));
    // 여기서 sizeof(int)는 정수의 크기를 알려주므로 4바이트이다.
    x[10] = 0;
    free(x);
}

int main(void)
{
    f();
    return 0;
}
```

- 10개의 정수를 위한 메모리를 할당한 후 그 메모리의 주소를 x라는 포인터에 저장한다.
- 정수 10개 크기의 메모리만을 할당했으므로 [0]~[9]까지의 메모리만 존재한다.
- 메모리의 연속된 공간에 정수가 10개 있는데, 그 공간을 넘어 접근한다면 이런 상황을 <b>버퍼 오버플로우</b>라고 한다.
- 여기서 버퍼는 메모리 배열이다.

<br>
<hr>
<a href="https://www.boostcourse.org/cs112">모두를 위한 컴퓨터과학(CS50 2019)</a> - 메모리 할당과 해제로 공부한 내용입니다.

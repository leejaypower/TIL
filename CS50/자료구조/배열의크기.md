# 배열의 크기

> 데이터 구조를 정의하고 관리하는 데 있어서 메모리와 포인터에 대한 개념을 정확히 이해하는 것이 중요하다.

### malloc과 포인터 예제

```c
int main(void)
{
    int *x;
    int *y;

    x = malloc(sizeof(int));

    *x = 42;
    *y = 13;
}
```

- 여기서 y는 포인터로만 선언되었다.
- y가 초기화되지 않았기 때문에 쓰레기값을 가진다.
- y는 원하지 않는 메모리 어딘가를 임의로 가리키고 있기 때문에 값을 저장할 때 오류가 발생할 수 있다.

<br>

### 이미 정의된 배열의 크기를 조정하기

- 배열의 크기는 미리 지정해야 한다.
- 배열의 크기가 일정하게 할당되어 있는 상태에서 단순히 크기를 늘릴 수 없다.
- 그 배열의 주변 메모리들은 이미 다른 목적으로 사용되고 있을 수 있기 때문이다.

<br>

이미 정의된 배열의 크기를 늘리려면 어떻게 해야될까?

<br>

새로운 공간에 메모리 크기를 다시 할당해서 기존 배열을 옮기는 방법: O(n)

```c
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
  //int 자료형 3개로 이루어진 list 라는 포인터를 선언하고 메모리 할당
  int *list = malloc(3 * sizeof(int));

  // 포인터가 잘 선언되었는지 확인
  if (list == NULL)
  {
      return 1;
  }

  // list 배열의 각 인덱스에 값 저장
  list[0] = 1;
  list[1] = 2;
  list[2] = 3;

  //int 자료형 4개 크기의 tmp 라는 포인터를 선언하고 메모리 할당
  int *tmp = malloc(4 * sizeof(int));

  if (tmp == NULL)
  {
      return 1;
  }

  // list의 값을 tmp로 복사
  for (int i = 0; i < 3; i++)
  {
      tmp[i] = list[i];
  }

  // tmp배열의 네 번째 값도 저장
  tmp[3] = 4;

  // list의 메모리를 초기화
  free(list);

  // list가 tmp와 같은 곳을 가리키도록 지정
  list = tmp;

  // 새로운 배열 list의 값 확인
  for (int i = 0; i < 4; i++)
  {
      printf("%i\n", list[i]);
  }

  // list의 메모리 초기화
  free(list);
}

```

- 배열의 크기만큼 많은 연산이 필요하고 실행시간이 오래걸린다.
- 이 예제는 시범을 위한 것으로, 만약 배열의 크기를 다시 지정하고 싶다면 이전 코드를 다시 짜면 된다.

<br>

위 과정을 좀 더 간단히 만들 수 있다.<br>
malloc대신 realloc을 사용해서 메모리를 새로 할당한다.

```c
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
    int *list = malloc(3 * sizeof(int));
    if (list == NULL)
    {
        return 1;
    }

    list[0] = 1;
    list[1] = 2;
    list[2] = 3;

    // tmp 포인터에 메모리를 할당하고 list의 값 복사
    int *tmp = realloc(list, 4 * sizeof(int));
    if (tmp == NULL)
    {
        return 1;
    }

    // list가 tmp와 같은 곳을 가리키도록 지정
    list = tmp;

    // 새로운 list의 네 번째 값 저장
    list[3] = 4;

    // list의 값 확인
    for (int i = 0; i < 4; i++)
    {
        printf("%i\n", list[i]);
    }

    //list 의 메모리 초기화
    free(list);
}
```

이처럼 이미 할당된 메모리의 크기를 조절하기 위해서는
임시 메모리를 새로 할당해야한다.<br>
데이터를 덮어씌우는 과정에서 기존의 데이터를 손실하는 문제를 방지하기 위함이다.

<br>
<hr>
<a href="https://www.boostcourse.org/cs112">모두를 위한 컴퓨터과학(CS50 2019)</a> - malloc과 포인터복습, 배열의 크기 조정하기로 공부한 내용입니다.
